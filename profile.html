<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <header class="profile-header">
        <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
        <a href="tracker.html" class="back-link">‚Üê –ù–∞–∑–∞–¥</a>
    </header>

    <main class="profile-main">
        <!-- –ë–ª–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-container">
            <div class="profile-card">
                <img id="avatar" src="img/default-avatar.png" alt="Avatar" class="avatar" />

                <!-- —Å–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                <input type="file" id="avatar-upload" accept="image/*" hidden />

                <button id="edit-profile-btn" class="profile-btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                <button id="change-avatar-btn">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>

                <p><strong>Email:</strong> <span id="user-email"></span></p>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="profile-options">
                <button id="notifications" class="option-btn">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                <button id="share" class="option-btn">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏</button>
                <button id="theme-toggle" class="option-btn">üåì –¢–µ–º–Ω–∞—è/–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>
            </div>
        </div>

        <!-- –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å -->
        <section class="report-section">
            <h2>–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å</h2>
            <canvas id="reportChart"></canvas>
        </section>
    </main>

    <footer class="profile-footer">
        <p>Version 1.3.9</p>
    </footer>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const emailSpan = document.getElementById("user-email");
            const userEmail = localStorage.getItem("userEmail") || "user@example.com";
            if (emailSpan) emailSpan.textContent = userEmail;

            // === –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –∞–≤–∞—Ç–∞—Ä ===
            const avatarImg = document.getElementById("avatar");
            const savedAvatar = localStorage.getItem("avatar");
            if (savedAvatar) avatarImg.src = savedAvatar;

            // === –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞ ===
            const avatarUpload = document.getElementById("avatar-upload");
            const changeAvatarBtn = document.getElementById("change-avatar-btn");

            changeAvatarBtn.addEventListener("click", () => avatarUpload.click());

            avatarUpload.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = () => {
                        avatarImg.src = reader.result;
                        localStorage.setItem("avatar", reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            });

            // === –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" ===
            document.getElementById("edit-profile-btn")?.addEventListener("click", () => {
                window.location.href = "edit_profile.html";
            });

            // === –î–∏–∞–≥—Ä–∞–º–º–∞ ===
            const ctx = document.getElementById("reportChart").getContext("2d");
            new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: ["–í—ã–ø–æ–ª–Ω–µ–Ω–æ", "–í –ø—Ä–æ—Ü–µ—Å—Å–µ", "–ü—Ä–æ–ø—É—â–µ–Ω–æ"],
                    datasets: [
                        {
                            data: [65, 25, 10],
                            backgroundColor: ["#4a90e2", "#a3c4f3", "#f8c8dc"],
                            borderWidth: 2,
                        },
                    ],
                },
                options: {
                    plugins: {
                        legend: {
                            position: "bottom",
                            labels: { color: "#333" },
                        },
                    },
                },
            });

            // === –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ===
            document.getElementById("notifications")?.addEventListener("click", () => {
                const incomplete = parseInt(localStorage.getItem("incompleteHabits")) || 3;
                alert(`–£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å ${incomplete} –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫`);
            });

            // === –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏ ===
            document.getElementById("share")?.addEventListener("click", () => {
                navigator.clipboard.writeText(window.location.href);
                alert("–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            });

            // === –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã ===
            const themeToggle = document.getElementById("theme-toggle");
            const savedTheme = localStorage.getItem("theme") || "light";
            document.body.classList.add(savedTheme);

            themeToggle.addEventListener("click", () => {
                if (document.body.classList.contains("light")) {
                    document.body.classList.replace("light", "dark");
                    localStorage.setItem("theme", "dark");
                } else {
                    document.body.classList.replace("dark", "light");
                    localStorage.setItem("theme", "light");
                }
            });
        });
    </script>
</body>

</html>