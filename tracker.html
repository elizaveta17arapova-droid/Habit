<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
  <link rel="stylesheet" href="style.css">
  <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <!-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ -->
  <script src="pwa-install.js" defer></script>
</head>

<body>
  <header>
    <h1>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</h1>
    <div id="profile">
      <img id="profile-img" class="avatar" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="–ê–≤–∞—Ç–∞—Ä">
      <span id="user-email"></span>
      <span id="current-date"></span>
      
      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
      <nav id="main-nav">
        <a href="profile.html" id="profile-menu-btn">‚ò∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        <a href="ai_assistant.html" id="ai-assistant-btn">ü§ñ –ò–ò –ü–æ–º–æ—â–Ω–∏–∫</a>
        <a href="articles.html" id="articles-btn">üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</a>
        <!-- ‚≠ê –ù–û–í–û–ï ‚Äî –ß–µ–ª–ª–µ–Ω–¥–∂–∏ -->
        <a href="challenges.html" id="challenges-btn">üåü –ß–µ–ª–ª–µ–Ω–¥–∂–∏</a>
        <a href="achievements.html" id="achievements-btn">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
      </nav>

      <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è -->
      <div id="profile-menu" class="profile-menu" style="display:none;">
        <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
        <img id="menu-avatar" class="avatar" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="–ê–≤–∞—Ç–∞—Ä">
        <input type="file" id="avatar-input" accept="image/*" style="display:none;">
        <button id="change-avatar-btn">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
        <p>Email: <span id="menu-email"></span></p>
        <button id="logout-btn">–í—ã–π—Ç–∏</button>
      </div>
    </div>
  </header>

  <div class="app-container">
    <main>
      <!-- –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ -->
      <section id="today-habits">
        <h2>–ü—Ä–∏–≤—ã—á–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã</h2>
        <div id="filter-bar">
          <button class="filter-btn active" data-filter="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
          <button class="filter-btn" data-filter="archived">–ê—Ä—Ö–∏–≤</button>
          <button class="filter-btn" data-filter="all">–í—Å–µ</button>
        </div>
        <ul id="habits"></ul>
      </section>

      <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ -->
      <section id="add-habit">
        <input type="text" id="habit-name" placeholder="–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞">
        <input type="date" id="habit-date">
        <button id="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
      </section>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <section id="stats">
        <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <p>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: <span id="completion">0%</span></p>
        <p>Streak —Ç–µ–∫—É—â–µ–π –ø—Ä–∏–≤—ã—á–∫–∏: <span id="streak">0</span> –¥–Ω–µ–π</p>
      </section>
      
      <div id="gamification-panel">
        <h3>üéØ –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
        <p>–û—á–∫–∏: <span id="gami-points">0</span></p>
        <p>–£—Ä–æ–≤–µ–Ω—å: <span id="gami-level">1</span></p>
        <p>–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: <span id="gami-next">100</span></p>
      </div>

      <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
      <section id="calendar">
        <h3>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
        <ul id="calendar-list"></ul>
      </section>

      <!-- –ê—Ä—Ö–∏–≤ -->
      <section id="archive">
        <h2>–ê—Ä—Ö–∏–≤ –ø—Ä–∏–≤—ã—á–µ–∫</h2>
        <div id="archive-filters">
          <button class="archive-filter active" data-filter="all">–í—Å–µ</button>
          <button class="archive-filter" data-filter="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
          <button class="archive-filter" data-filter="active">üïì –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
        </div>
        <ul id="archived-habits"></ul>
      </section>

      <!-- ‚≠ê –ù–æ–≤—ã–π –±–ª–æ–∫ ‚Äî –ê–∫—Ç–∏–≤–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏ -->
      <section id="active-challenges">
        <h2>üåü –ê–∫—Ç–∏–≤–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h2>
        <ul id="challenge-list"></ul>
      </section>

    </main>
  </div>

  <script src="tracker.js"></script>
  <script src="gamification.js"></script>
  <link rel="stylesheet" href="style_gamification.css">
  <button id="installBtn" class="pwa-install-btn">
  üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
</button>

<script src="pwa-install.js"></script>

<script>
// ================== üéØ –ê–∫—Ç–∏–≤–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏ ==================
function renderActiveChallenges() {
    const challengeListEl = document.getElementById('challenge-list');
    challengeListEl.innerHTML = '';

    const challengeKeys = ["challenge1", "challenge2", "challenge3"];
    const challengeNames = {
        "challenge1": "7 –¥–Ω–µ–π –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å–Ω–∞ üò¥",
        "challenge2": "7 –¥–Ω–µ–π —Å–ø–æ—Ä—Ç–∞ üèÉ‚Äç‚ôÄÔ∏è",
        "challenge3": "7 –¥–Ω–µ–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è ü•ó"
    };

    const challengeDescriptions = {
        "challenge1": [
            "–î–µ–Ω—å 1: –õ–æ–∂–∏—Ç—å—Å—è —Å–ø–∞—Ç—å –¥–æ 23:00",
            "–î–µ–Ω—å 2: –ú–∏–Ω–∏–º—É–º 8 —á–∞—Å–æ–≤ —Å–Ω–∞",
            "–î–µ–Ω—å 3: –ù–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º",
            "–î–µ–Ω—å 4: –ú–µ–¥–∏—Ç–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–Ω–æ–º",
            "–î–µ–Ω—å 5: –ß—Ç–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
            "–î–µ–Ω—å 6: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Ä–µ–∂–∏–º —Å–Ω–∞",
            "–î–µ–Ω—å 7: –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –Ω–µ–¥–µ–ª–∏"
        ],
        "challenge2": [
            "–î–µ–Ω—å 1: 15 –º–∏–Ω—É—Ç —Ä–∞–∑–º–∏–Ω–∫–∏",
            "–î–µ–Ω—å 2: 20 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã",
            "–î–µ–Ω—å 3: 15 –º–∏–Ω—É—Ç —Å–∏–ª–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
            "–î–µ–Ω—å 4: 20 –º–∏–Ω—É—Ç —Ä–∞—Å—Ç—è–∂–∫–∏",
            "–î–µ–Ω—å 5: 15 –º–∏–Ω—É—Ç –∫–∞—Ä–¥–∏–æ",
            "–î–µ–Ω—å 6: 15 –º–∏–Ω—É—Ç –π–æ–≥–∏",
            "–î–µ–Ω—å 7: –ò—Ç–æ–≥–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞"
        ],
        "challenge3": [
            "–î–µ–Ω—å 1: –°—ä–µ—Å—Ç—å 2 –ø–æ—Ä—Ü–∏–∏ –æ–≤–æ—â–µ–π",
            "–î–µ–Ω—å 2: –ü–æ–ª–µ–∑–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫",
            "–î–µ–Ω—å 3: –ó–∞–º–µ–Ω–∏—Ç—å —Å–ª–∞–¥–æ—Å—Ç–∏ —Ñ—Ä—É–∫—Ç–∞–º–∏",
            "–î–µ–Ω—å 4: –ü–æ–ª–µ–∑–Ω—ã–π –æ–±–µ–¥",
            "–î–µ–Ω—å 5: –ü–æ–ª–µ–∑–Ω—ã–π —É–∂–∏–Ω",
            "–î–µ–Ω—å 6: –ü–∏—Ç—å –±–æ–ª—å—à–µ –≤–æ–¥—ã",
            "–î–µ–Ω—å 7: –ò—Ç–æ–≥ –¥–Ω—è ‚Äî –∑–¥–æ—Ä–æ–≤–æ–µ –º–µ–Ω—é"
        ]
    };

    challengeKeys.forEach(key => {
        if (localStorage.getItem('active_' + key)) {
            const progress = parseInt(localStorage.getItem(key) || "0");

            const li = document.createElement('li');
            li.style.marginBottom = '12px';
            li.innerHTML = `
                <strong>${challengeNames[key]}</strong> ‚Äî –¥–µ–Ω—å ${progress} –∏–∑ 7
                <ul>
                    ${challengeDescriptions[key].map((d, i) => `<li style="color:${i < progress ? 'green' : 'black'}">${d}</li>`).join('')}
                </ul>
            `;
            challengeListEl.appendChild(li);
        }
    });

    if (!challengeListEl.hasChildNodes()) {
        challengeListEl.innerHTML = '<li>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</li>';
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
setInterval(renderActiveChallenges, 2000);
renderActiveChallenges();
</script>

</body>
</html>
